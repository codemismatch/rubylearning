/* Enhanced Syntax Highlighting for Code Blocks */

/* Code block container styling */
pre[class*="language-"] {
  /* margin: 2em 0; */
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  position: relative;
  overflow: hidden;
}

/* Add language label */
pre[class*="language-"]::before {
  content: attr(class);
  position: absolute;
  top: 0;
  right: 0;
  color: #f8f8f2;
  background-color: rgba(0, 0, 0, 0.3);
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem;
  border-bottom-left-radius: 8px;
  font-family: 'JetBrains Mono', monospace;
  text-transform: uppercase;
}

pre.language-ruby::before {
  content: 'Ruby';
  background-color: rgba(204, 52, 45, 0.6);
}

pre.language-markdown::before {
  content: 'Markdown';
  background-color: rgba(113, 80, 160, 0.6);
}

pre.language-javascript::before,
pre.language-js::before {
  content: 'JavaScript';
  background-color: rgba(247, 223, 30, 0.6);
  color: #333;
}

pre.language-html::before {
  content: 'HTML';
  background-color: rgba(227, 79, 38, 0.6);
}

pre.language-css::before {
  content: 'CSS';
  background-color: rgba(33, 150, 243, 0.6);
}

pre.language-bash::before,
pre.language-shell::before {
  content: 'Shell';
  background-color: rgba(46, 204, 113, 0.6);
}

/* Line highlight effect */
.line-highlight {
  background: rgba(255, 255, 255, 0.1);
  position: absolute;
  left: 0;
  right: 0;
}

/* Enhanced token styling */
.token.comment {
  color: #8292a2;
  font-style: italic;
}

.token.string, 
.token.char, 
.token.attr-value, 
.token.builtin, 
.token.inserted {
  color: #a6e22e;
}

.token.keyword {
  color: #66d9ef;
  font-style: italic;
}

.token.function,
.token.class-name {
  color: #e6db74;
}

.token.number {
  color: #ae81ff;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
  color: #f92672;
}

/* Improved inline code styling */
:not(pre) > code:not([class*="language-"]) {
  background-color: rgba(204, 52, 45, 0.05);
  padding: 0.2em 0.4em;
  border-radius: 3px;
  font-size: 0.9em;
  color: var(--primary-color);
  font-weight: 500;
  font-family: 'JetBrains Mono', monospace;
}

/* Code window enhancements */
.code-window {
  margin: 2em 0;
  border-radius: 8px;
  overflow: hidden; /* Keep hidden for border-radius, but content can expand */
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  background-color: var(--code-bg);
  /* Allow code windows to expand to show all content - no height restriction */
}

.code-header {
  background-color: #3c3f41;
  padding: 0.75rem 1rem;
  display: flex;
  align-items: center;
  position: relative;
}

.window-btn {
  width: 12px;
  height: 12px;
  border-radius: 6px;
  margin-right: 8px;
}

.window-btn.red {
  background-color: #ff5f56;
}

.window-btn.yellow {
  background-color: #ffbd2e;
}

.window-btn.green {
  background-color: #27c93f;
}

.window-title {
  color: #ddd;
  font-size: 0.85rem;
  font-family: 'JetBrains Mono', monospace;
  margin-left: 8px;
}

.copy-button {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  color: #ddd;
  cursor: pointer;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 5px;
  opacity: 0.7;
  transition: opacity 0.2s;
}

.copy-button:hover {
  opacity: 1;
}

.code-content {
  padding: 1rem;
  /* Allow code content to expand naturally - no height restrictions */
}

.code-content pre {
  margin: 0;
  /* Allow pre elements to automatically fit content height */
  white-space: pre;
  word-wrap: normal;
  height: auto;
  min-height: auto;
  max-height: none;
  overflow: visible;
}

/* Syntax highlighting override for Ruby's common elements */
.language-ruby .token.keyword {
  color: #66d9ef; /* def, class, end, etc. */
}

.language-ruby .token.function {
  color: #a6e22e; /* method names */
}

.language-ruby .token.comment {
  color: #75715e; /* comments */
}

.language-ruby .token.string {
  color: #e6db74; /* string literals */
}

.language-ruby .token.symbol {
  color: #fd971f; /* symbols like :symbol */
}

.language-ruby .token.constant {
  color: #ae81ff; /* constants like PI */
}

.language-ruby .token.variable {
  color: #fd971f; /* instance variables */
}

.language-ruby .token.class-name {
  color: #a6e22e; /* class names */
}

/* Ruby-exec editable code blocks */
.code-editor {
  position: relative;
}

.code-editor__highlight {
  margin: 0;
  padding: 1rem;
  min-height: auto;
  /* Allow code windows to automatically fit content height */
  max-height: none;
  height: auto;
  background: #272822;
  color: #f8f8f2;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  border-radius: 4px;
  overflow: visible;
  pointer-events: none;
  line-height: 1.5;
}

.code-editor__input {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 1rem;
  border: none;
  background: transparent;
  color: transparent;
  caret-color: #f97316;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 1rem;
  line-height: 1.5;
  white-space: pre;
  resize: none;
  overflow: hidden;
  z-index: 2;
}

.code-editor__input:focus {
  outline: none;
}

.output-area {
  background: #1e1e1e;
  border-top: 1px solid #444;
  padding: 10px;
  margin-top: 10px;
}

.output-content {
  white-space: pre-wrap;
  word-wrap: break-word;
}






.run-button {
  background: #28a745;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  position: absolute;
  right: 80px;
  font-size: 14px;
  transition: background 0.2s ease;
}

.run-button:hover {
  background: #218838;
}

/* Check button for practice blocks - runs automated tests */
.run-button.check-button {
  background: #007bff;
  right: 80px; /* Same position as Run button */
}

.run-button.check-button:hover {
  background: #0056b3;
}

/* Show code button for practice blocks */
.show-button,
.show-solution-button {
  background: #cc332d;
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  position: absolute;
  right: 180px; /* To the left of Check button */
  font-size: 14px;
  transition: background 0.2s ease;
}

.show-button:hover,
.show-solution-button:hover {
  background: #a52823;
}

.confetti-piece {
  position: fixed;
  width: 8px;
  height: 14px;
  border-radius: 2px;
  pointer-events: none;
  opacity: 0.9;
  animation: confetti-fall 1.1s ease-out forwards;
  z-index: 2000;
}

@keyframes confetti-fall {
  to {
    transform: translate3d(var(--confetti-x, 0px), var(--confetti-y, 60px), 0) rotate(360deg);
    opacity: 0;
  }
}

/* .code-content { */
/*   background: #2d2d2d; */
/*   color: #d4d4d4; */
/*   font-family: 'JetBrains Mono', monospace; */
/*   font-size: 14px; */
/*   padding: 10px; */
/*   min-height: 150px; */
/*   overflow-y: auto; */
/*   white-space: pre-wrap; /\* Preserve whitespace and enable wrapping *\/ */
/*   word-wrap: break-word; /\* Break long lines *\/ */
/* } */

/* .output-area { */
/*   background: #2d2d2d; */
/*   padding: 10px; */
/*   border-radius: 4px; */
/*   height: 150px; */
/*   overflow-y: auto; */
/* } */

.output-content {
  white-space: pre-wrap;
  word-wrap: break-word;
  color: tomato;
}

/* Inline Ruby console (virtual irb) */
.ruby-irb {
  margin: 2rem 0;
  padding: 1rem 1.25rem;
  border-radius: 8px;
  background-color: #111827;
  color: #e5e7eb;
  font-family: 'JetBrains Mono', SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  max-height: 82vh; /* align with taller drawer */
  box-sizing: border-box;
}

.ruby-irb-output {
  max-height: 68vh; /* more room for history */
  overflow-y: auto;
  padding: 0.25rem 0 0 0;
  border-bottom: none;
  margin-bottom: 0;
  font-size: 0.9rem;
}

.ruby-irb-line {
  white-space: pre-wrap;
  line-height: 1.3;
  margin-bottom: 0.05rem;
}

.ruby-irb-label {
  color: #f97316; /* orange prompt */
  font-weight: 600;
}

.ruby-irb-code {
  color: #facc15;
}

.ruby-irb-result-marker {
  color: #22c55e;
  font-weight: 600;
}

.ruby-irb-result-value {
  color: #a7f3d0;
}

.ruby-irb-line--input {
  color: #f9d149;
}

.ruby-irb-line--result {
  color: #a7f3d0;
}

.ruby-irb-line--error {
  color: #fca5a5;
}

.ruby-irb-line--info {
  color: #9ca3af;
}

.ruby-irb-line--intro {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.ruby-irb-line--intro-green {
  color: #4ade80;
}

.ruby-irb-line--intro-red {
  color: #fca5a5;
}

/* White intro helper line (e.g., "Try:") */
.ruby-irb-line--intro-white {
  color: #e5e7eb;
}

/* Tint the diamond emoji to ruby red */
.tinted-diamond {
  filter: hue-rotate(154deg) saturate(2.9) brightness(0.9) contrast(1.5) sepia(0) invert(0) grayscale(0) opacity(1);
  font-size: 36px; /* default large diamond */
  line-height: 1;
  display: inline-block;
  vertical-align: -0.15em;
  margin-right: 0.25rem;
}

/* Use a smaller diamond in the Mini Ruby console intro */
.ruby-irb-line--intro .tinted-diamond {
  font-size: 24px;
  vertical-align: -0.1em;
}

/* Ruby SVG icon for console heading */
.ruby-icon {
  display: inline-block;
  vertical-align: -0.2em;
  margin-right: 0.4rem;
  flex-shrink: 0;
}
.overlay-diamond {
  position: relative;
  display: inline-block;
  font-size: 36px; /* smaller */
}
.overlay-diamond::after {
  content: '';
  position: absolute;
  inset: 0;
  background-color: rgba(204, 52, 45, 0.4);
  mix-blend-mode: multiply;
  border-radius: 15%;
  pointer-events: none;
}

.ruby-irb-form {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  border-top: none;
  padding: 0;
  margin-top: -10px;
  line-height: 10px;
}

.ruby-irb-prompt {
  color: #22c55e; /* green prompt */
  font-weight: 600;
  font-family: 'JetBrains Mono', SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.9rem;
}

.ruby-irb-input-wrapper {
  position: relative;
  flex: 1;
  min-height: 2rem;
}

.ruby-irb-caret {
  position: absolute;
  top: 0.4rem;
  left: 0.1rem;
  width: 1.1ch;
  height: 1.1em;
  background-color: #f97316; /* orange to match prompt */
  border: none;
  pointer-events: none;
  z-index: 9999;
  animation: ruby-caret-blink 1s ease-in-out infinite;
}

@keyframes ruby-caret-blink {
  0%, 49% {
    opacity: 1;
  }
  50%, 100% {
    opacity: 0;
  }
}

.ruby-irb-ghost {
  display: inline-block;
  position: relative;
  z-index: 1;
  margin: 0;
  padding: 0.4rem 0.1rem;
  font-family: 'JetBrains Mono', SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.9rem;
  line-height: 1.4;
  color: #9ca3af;
  white-space: pre-wrap;
  max-width: 100%;
  overflow: hidden;
}

.ruby-irb-input {
  position: absolute;
  inset: 0;
  padding: 0.4rem 0.1rem;
  border-radius: 0;
  border: none;
  background-color: transparent;
  color: transparent; /* ghost handles visible text */
  font-size: 0.9rem;
  line-height: 1.4;
  font-family: 'JetBrains Mono', SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  caret-color: transparent; /* hide native caret; we render a block caret */
  resize: none;
  z-index: 0;
}

.ruby-irb-input:focus {
  outline: none;
  border: none;
}

/* Syntax highlighting for Ruby console ghost text */
.ruby-irb-ghost .token.keyword {
  color: #c678dd; /* keywords: def, class, end, if, etc. - purple */
  font-weight: 600;
}

.ruby-irb-ghost .token.function,
.ruby-irb-ghost .token.method,
.ruby-irb-ghost .token.builtin {
  color: #56b6c2; /* built-in methods: puts, print, gets, etc. - cyan */
  font-weight: 600;
}

.ruby-irb-ghost .token.string {
  color: #98c379; /* strings - green */
}

.ruby-irb-ghost .token.symbol {
  color: #e5c07b; /* symbols like :hi - bright gold/yellow */
  font-weight: 600;
}

.ruby-irb-ghost .token.number,
.ruby-irb-ghost .token.constant {
  color: #d19a66; /* numbers and constants - orange */
}

.ruby-irb-ghost .token.operator,
.ruby-irb-ghost .token.punctuation {
  color: #abb2bf; /* operators and punctuation - light gray */
}

.ruby-irb-ghost .token.comment {
  color: #5c6370; /* comments - dark gray */
  font-style: italic;
}

.ruby-irb-ghost .token.variable,
.ruby-irb-ghost .token.instance-variable {
  color: #e06c75; /* variables - red */
}

/* Console output syntax highlighting */
.ruby-irb-code .token.keyword {
  color: #c678dd;
  font-weight: 600;
}

.ruby-irb-code .token.function,
.ruby-irb-code .token.method,
.ruby-irb-code .token.builtin {
  color: #56b6c2;
  font-weight: 600;
}

.ruby-irb-code .token.string {
  color: #98c379;
}

.ruby-irb-code .token.symbol {
  color: #e5c07b;
  font-weight: 600;
}

.ruby-irb-code .token.number,
.ruby-irb-code .token.constant {
  color: #d19a66;
}

.ruby-irb-code .token.operator,
.ruby-irb-code .token.punctuation {
  color: #abb2bf;
}

.ruby-irb-code .token.comment {
  color: #5c6370;
  font-style: italic;
}

.ruby-irb-code .token.variable,
.ruby-irb-code .token.instance-variable {
  color: #e06c75;
}
